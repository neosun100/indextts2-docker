# IndexTTS2 全面性能测试报告

**测试时间**: 2025-12-07
**测试方法**: 每个版本测试5次，取平均值
**测试场景**: 4个场景（中文短/长、英文短/长）
**测试版本**: 4个版本

---

## 📊 测试结果总览

### 性能对比表（平均响应时间）

| 版本 | 中文短文本<br>(~20字) | 中文长文本<br>(~100字) | 英文短文本<br>(~20词) | 英文长文本<br>(~100词) | 综合评分 |
|------|:---:|:---:|:---:|:---:|:---:|
| **v2.0-production** | 6.6秒 | 28.2秒 | 8.0秒 | 37.5秒 | ⭐⭐⭐⭐ |
| **v2.1-cuda** | 6.9秒 | 28.3秒 | 7.6秒 | 35.5秒 | ⭐⭐⭐⭐ |
| **v2.1-deepspeed** | **3.7秒** 🥈 | **20.9秒** 🥈 | **4.6秒** 🥈 | ❌ 失败 | ⭐⭐⭐⭐ |
| **v2.1-turbo** | **3.6秒** 🥇 | **20.1秒** 🥇 | **4.3秒** 🥇 | ❌ 失败* | ⭐⭐⭐⭐⭐ |

*注：v2.1-turbo 在英文长文本场景中，第1次测试成功(31.4秒)，其余4次失败*

---

## 🚀 性能提升分析（相对v2.0-production）

### 中文短文本（~20字）

| 版本 | 平均耗时 | 性能提升 | 标准差 |
|------|---------|---------|--------|
| v2.0-production | 6.6秒 | 基准 | 0.37秒 |
| v2.1-cuda | 6.9秒 | **-4.5%** ⚠️ | 0.38秒 |
| v2.1-deepspeed | **3.7秒** | **+44.4%** 🔥 | 0.27秒 |
| v2.1-turbo | **3.6秒** | **+45.5%** 🔥🔥 | 0.21秒 |

### 中文长文本（~100字）

| 版本 | 平均耗时 | 性能提升 | 标准差 |
|------|---------|---------|--------|
| v2.0-production | 28.2秒 | 基准 | 1.58秒 |
| v2.1-cuda | 28.3秒 | **-0.4%** | 0.71秒 |
| v2.1-deepspeed | **20.9秒** | **+25.9%** 🔥 | 0.56秒 |
| v2.1-turbo | **20.1秒** | **+28.7%** 🔥🔥 | 1.03秒 |

### 英文短文本（~20词）

| 版本 | 平均耗时 | 性能提升 | 标准差 |
|------|---------|---------|--------|
| v2.0-production | 8.0秒 | 基准 | 0.79秒 |
| v2.1-cuda | 7.6秒 | **+5.0%** ✅ | 0.45秒 |
| v2.1-deepspeed | **4.6秒** | **+42.5%** 🔥 | 0.21秒 |
| v2.1-turbo | **4.3秒** | **+46.3%** 🔥🔥 | 0.24秒 |

### 英文长文本（~100词）

| 版本 | 平均耗时 | 性能提升 | 成功率 |
|------|---------|---------|--------|
| v2.0-production | 37.5秒 | 基准 | 100% (5/5) |
| v2.1-cuda | 35.5秒 | **+5.3%** ✅ | 100% (5/5) |
| v2.1-deepspeed | ❌ | **失败** | 0% (0/5) |
| v2.1-turbo | 31.4秒* | **+16.3%*** | 20% (1/5) |

*仅第1次成功，其余4次失败

---

## 🎯 关键发现

### ✅ 重大突破

1. **v2.1-turbo 是短文本和中长文本的绝对冠军**
   - 中文短文本快 **45.5%**
   - 中文长文本快 **28.7%**
   - 英文短文本快 **46.3%**
   - 稳定性好（成功场景标准差小）

2. **v2.1-deepspeed 性能也非常出色**
   - 所有成功场景都比基准快 **26-44%**
   - 仅次于 v2.1-turbo

3. **v2.1-cuda 表现平平**
   - 中文场景无提升甚至略慢
   - 英文场景略快 5%
   - 不推荐用于生产环境

### ⚠️ 严重问题

**英文长文本处理失败**：
- **v2.1-deepspeed**: 100% 失败率（5/5次都是HTTP 500）
- **v2.1-turbo**: 80% 失败率（4/5次HTTP 500）

**可能原因**：
1. 内存限制或OOM问题
2. 长文本超过某个处理上限
3. 优化版本对长文本处理有bug
4. 英文文本token数量更多导致资源耗尽

---

## 📈 详细统计数据

### v2.0-production（基准版本）
```
中文短文本:  6.6秒 (min: 6.0s, max: 6.9s, std: 0.37s)
中文长文本: 28.2秒 (min: 25.8s, max: 30.1s, std: 1.58s)
英文短文本:  8.0秒 (min: 7.3s, max: 9.2s, std: 0.79s)
英文长文本: 37.5秒 (min: 34.0s, max: 39.7s, std: 2.16s)
成功率: 100% (20/20)
启动时间: 90秒
```

### v2.1-cuda（CUDA优化版本）
```
中文短文本:  6.9秒 (min: 6.4s, max: 7.3s, std: 0.38s) ⚠️ 略慢
中文长文本: 28.3秒 (min: 27.5s, max: 29.1s, std: 0.71s)
英文短文本:  7.6秒 (min: 7.0s, max: 8.1s, std: 0.45s) ✅ 快5%
英文长文本: 35.5秒 (min: 34.1s, max: 38.3s, std: 1.86s) ✅ 快5.3%
成功率: 100% (20/20)
启动时间: 180秒（需编译CUDA kernel）
```

### v2.1-deepspeed（DeepSpeed优化版本）⭐
```
中文短文本:  3.7秒 (min: 3.4s, max: 4.1s, std: 0.27s) 🔥 快44.4%
中文长文本: 20.9秒 (min: 20.1s, max: 21.4s, std: 0.56s) 🔥 快25.9%
英文短文本:  4.6秒 (min: 4.4s, max: 4.8s, std: 0.21s) 🔥 快42.5%
英文长文本: ❌ 全部失败 (HTTP 500)
成功率: 75% (15/20)
启动时间: 90秒
```

### v2.1-turbo（Turbo优化版本）⭐⭐
```
中文短文本:  3.6秒 (min: 3.5s, max: 4.0s, std: 0.21s) 🔥🔥 快45.5%
中文长文本: 20.1秒 (min: 19.2s, max: 21.8s, std: 1.03s) 🔥🔥 快28.7%
英文短文本:  4.3秒 (min: 4.1s, max: 4.6s, std: 0.24s) 🔥🔥 快46.3%
英文长文本: 31.4秒* (仅1次成功) / ❌ 4次失败 (HTTP 500)
成功率: 80% (16/20)
启动时间: 180秒（需编译）
```

---

## 🎨 性能可视化对比

### 中文短文本（越短越好）
```
v2.0-production  ██████████████████████ 6.6秒
v2.1-cuda        ███████████████████████ 6.9秒 ⚠️
v2.1-deepspeed   ████████████ 3.7秒 🥈
v2.1-turbo       ███████████ 3.6秒 🥇
```

### 中文长文本（越短越好）
```
v2.0-production  ████████████████████████████████████████████ 28.2秒
v2.1-cuda        ████████████████████████████████████████████ 28.3秒
v2.1-deepspeed   ████████████████████████████████ 20.9秒 🥈
v2.1-turbo       ██████████████████████████████ 20.1秒 🥇
```

### 英文短文本（越短越好）
```
v2.0-production  █████████████████████████ 8.0秒
v2.1-cuda        ███████████████████████ 7.6秒 ✅
v2.1-deepspeed   ██████████████ 4.6秒 🥈
v2.1-turbo       ████████████ 4.3秒 🥇
```

### 英文长文本（越短越好）
```
v2.0-production  █████████████████████████████████████████████████████ 37.5秒
v2.1-cuda        ██████████████████████████████████████████████████ 35.5秒 ✅
v2.1-deepspeed   ❌ 失败 (HTTP 500)
v2.1-turbo       ████████████████████████████████████████ 31.4秒* (仅1次)
```

---

## 💡 推荐方案

### 🏆 场景一：短文本和中长文本（推荐 v2.1-turbo）

**适用场景**：
- 中文文本 ≤ 100字
- 英文文本 ≤ 20词
- 追求极致性能

**推荐版本**: `neosun/indextts2:v2.1-turbo`

**优势**：
- ✅ 最快速度（比基准快 29-46%）
- ✅ 稳定性好（短/中长文本成功率100%）
- ✅ 标准差小（性能稳定）

**注意事项**：
- ⚠️ 启动时间长（180秒，需编译）
- ⚠️ 不支持英文长文本（>100词会失败）

**Docker命令**：
```bash
docker pull neosun/indextts2:v2.1-turbo

docker run -d \
  --name indextts2 \
  --restart=always \
  --gpus all \
  -p 7870:7870 \
  -p 8002:8002 \
  -v /tmp/indextts-outputs:/app/outputs \
  neosun/indextts2:v2.1-turbo
```

---

### 🥈 场景二：混合场景（推荐 v2.1-deepspeed）

**适用场景**：
- 快速启动需求（90秒 vs 180秒）
- 短文本和中长文本为主
- 不处理英文长文本

**推荐版本**: `neosun/indextts2:v2.1-deepspeed`

**优势**：
- ✅ 性能优异（比基准快 26-44%）
- ✅ 启动快速（90秒）
- ✅ 无需编译

**注意事项**：
- ⚠️ 不支持英文长文本（>100词会失败）

**Docker命令**：
```bash
docker pull neosun/indextts2:v2.1-deepspeed

docker run -d \
  --name indextts2 \
  --restart=always \
  --gpus all \
  -p 7870:7870 \
  -p 8002:8002 \
  -v /tmp/indextts-outputs:/app/outputs \
  neosun/indextts2:v2.1-deepspeed
```

---

### 🛡️ 场景三：稳定性优先（推荐 v2.0-production）

**适用场景**：
- 需要处理英文长文本
- 稳定性 > 性能
- 所有场景都需要支持

**推荐版本**: `neosun/indextts2:v2.0-production`

**优势**：
- ✅ 100% 成功率（所有场景）
- ✅ 经过充分验证
- ✅ 无任何限制

**劣势**：
- ⚠️ 性能较慢（比turbo慢 29-46%）

**Docker命令**：
```bash
docker pull neosun/indextts2:v2.0-production

docker run -d \
  --name indextts2 \
  --restart=always \
  --gpus all \
  -p 7870:7870 \
  -p 8002:8002 \
  -v /tmp/indextts-outputs:/app/outputs \
  neosun/indextts2:v2.0-production
```

---

### ❌ 不推荐：v2.1-cuda

**原因**：
- 中文场景无提升甚至略慢
- 英文场景仅提升 5%
- 启动时间长（180秒）
- 性价比低

---

## 🔧 混合部署建议

针对不同的使用场景，可以考虑混合部署多个版本：

### 方案A：按文本长度路由

```
短文本（<20字/词）  → v2.1-turbo（最快）
中长文本（20-100）   → v2.1-turbo（最快）
长文本（>100）       → v2.0-production（稳定）
```

### 方案B：按语言路由

```
中文（所有长度）     → v2.1-turbo（最快）
英文短文本          → v2.1-turbo（最快）
英文长文本          → v2.0-production（稳定）
```

### 方案C：按重要性路由

```
高性能需求          → v2.1-turbo
一般需求           → v2.1-deepspeed
关键任务           → v2.0-production（最稳定）
```

---

## 🔍 问题分析

### 为什么 v2.1-cuda 没有提升？

1. **硬件限制**：当前GPU可能不是CUDA Kernel的最佳目标
2. **文本长度**：测试文本较短，无法体现CUDA优化的优势
3. **优化场景**：CUDA Kernel可能针对不同的使用场景优化

### 为什么 DeepSpeed 和 Turbo 这么快？

1. **推理优化**：专门针对推理场景优化
2. **内存管理**：更高效的显存使用
3. **算子融合**：自动融合多个操作
4. **编译优化**：Turbo使用Torch Compile进行JIT优化

### 为什么英文长文本会失败？

**可能原因**：
1. **内存限制**：英文token数量多，导致OOM
2. **上下文长度**：超过模型处理上限
3. **优化bug**：优化版本对长文本处理有缺陷
4. **资源耗尽**：GPU内存或计算资源不足

**验证方法**：
```bash
# 查看容器日志
docker logs indextts2

# 查看GPU内存使用
nvidia-smi
```

**临时解决方案**：
- 将英文长文本拆分成多个短文本
- 使用 v2.0-production 处理长文本
- 增加GPU内存限制

---

## 📝 测试环境

- **GPU**: NVIDIA GPU (CUDA 12.1)
- **容器**: Docker with GPU support
- **测试方法**: REST API调用
- **测试次数**: 每版本每场景5次
- **预热**: 每版本测试前预热1次
- **测试时间**: 2025-12-07

---

## 📊 原始数据

完整测试数据保存在：
- **CSV文件**: `/tmp/benchmark-comprehensive-20251207-102606/results.csv`
- **音频文件**: `/tmp/benchmark-comprehensive-20251207-102606/*.wav`
- **日志文件**: `/tmp/benchmark_comprehensive.log`

---

## ✅ 最终结论

### 生产环境推荐

**首选**: `neosun/indextts2:v2.1-turbo`

**理由**：
- ✅ 最快速度（比基准快 29-46%）
- ✅ 稳定性优秀（短/中长文本）
- ✅ 标准差小（性能稳定）

**限制**：
- ⚠️ 不支持英文长文本（需配合 v2.0-production 使用）

### 推荐架构

```
                    ┌─────────────────┐
                    │   负载均衡器    │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │                              │
    ┌─────────▼────────┐         ┌─────────▼────────┐
    │  v2.1-turbo      │         │  v2.0-production │
    │  (短/中长文本)    │         │  (英文长文本)    │
    └──────────────────┘         └──────────────────┘
```

---

**测试完成时间**: 2025-12-07 11:06
**总测试时长**: 约40分钟
**测试脚本**: `benchmark_comprehensive.sh`
